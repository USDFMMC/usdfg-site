import{i as e,a as o,u as n,P as t,K as r,g as a,U as i,B as s,T as c,b as l,S as g,c as d,d as u,e as f,f as S}from"./index-33fQiL3V.js";import"./ui-C_ecRgbg.js";import"./vendor-BoDUibaF.js";async function y(e,o){const[n]=t.findProgramAddressSync([S.ADMIN],l),[r]=t.findProgramAddressSync([S.PRICE_ORACLE],l),[a]=t.findProgramAddressSync([S.CHALLENGE,e.toBuffer(),o.toBuffer()],l),[s]=t.findProgramAddressSync([S.ESCROW_WALLET],l),[c]=t.findProgramAddressSync([S.ESCROW_WALLET,a.toBuffer(),i.toBuffer()],l);return{adminStatePDA:n,priceOraclePDA:r,challengePDA:a,escrowWalletPDA:s,escrowTokenAccountPDA:c}}async function p(S,p,b){try{if(console.log("ğŸš€ Creating challenge on smart contract..."),console.log("   Entry fee:",b,"USDFG"),!S?.publicKey)throw new Error("âŒ Wallet not connected. Please connect your wallet first.");if(console.log("âœ… Wallet connected:",S.publicKey.toString()),!b||b<=0)throw new Error("âŒ Invalid entry fee. Must be greater than 0.");if(console.log("âœ… Entry fee valid:",b,"USDFG"),!S.signTransaction)throw new Error("âŒ Wallet does not support transaction signing.");console.log("âœ… Wallet has signTransaction method");try{await e(p)?console.log("âœ… Smart contract already initialized"):(console.log("âš ï¸ Smart contract not initialized. Initializing now..."),await o(S,p),console.log("âœ… Smart contract initialized!")),console.log("ğŸ”„ Attempting to refresh oracle before challenge creation...");try{await n(S,p),console.log("âœ… Oracle refreshed successfully"),await new Promise(e=>setTimeout(e,2e3))}catch(h){console.log("âš ï¸ Oracle refresh failed, but continuing with challenge creation:",h)}}catch(w){throw console.error("âŒ Error checking/initializing smart contract:",w),new Error("Smart contract initialization failed. Please contact support.")}console.log("ğŸ”§ Step 1: Preparing transaction (bypassing Anchor)...");const A=new t(S.publicKey.toString());console.log("ğŸ‘¤ Creator:",A.toString()),console.log("ğŸ”§ Step 2: Generating challenge seed...");const m=r.generate();console.log("ğŸ”‘ Challenge seed:",m.publicKey.toString()),console.log("ğŸ”§ Step 3: Deriving PDAs...");const P=await y(A,m.publicKey);console.log("ğŸ“ Challenge PDA:",P.challengePDA.toString()),console.log("ğŸ”§ Step 4: Getting token account...");const k=await a(i,A);console.log("ğŸ’³ Token account:",k.toString()),console.log("ğŸ’° Entry fee (raw USDFG):",b);const W=new s(b);console.log("ğŸ’° Created BN:",W.toString());const D=Buffer.from([170,244,47,1,1,15,173,239]),E=Buffer.alloc(8);W.toArrayLike(Buffer,"le",8).copy(E);const C=Buffer.concat([D,E]);console.log("ğŸ“¦ Instruction data created"),console.log("ğŸ”„ Attempting to bypass oracle check by modifying instruction keys...");const T=new c({keys:[{pubkey:P.challengePDA,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!0,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:P.escrowTokenAccountPDA,isSigner:!1,isWritable:!0},{pubkey:P.escrowWalletPDA,isSigner:!1,isWritable:!1},{pubkey:m.publicKey,isSigner:!0,isWritable:!1},{pubkey:g.programId,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:P.priceOraclePDA,isSigner:!1,isWritable:!1},{pubkey:P.adminStatePDA,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1}],programId:l,data:C});console.log("âœ… Instruction created");const B=(new f).add(T);B.feePayer=A,B.recentBlockhash=(await p.getLatestBlockhash()).blockhash,console.log("ğŸ”§ Signing transaction...");const L=await S.signTransaction(B);L.partialSign(m),console.log("ğŸš€ Sending transaction...");const I=await p.sendRawTransaction(L.serialize());return console.log("â³ Confirming transaction..."),await p.confirmTransaction(I,"confirmed"),console.log("âœ… Challenge created! Transaction:",I),console.log("ğŸ“¦ Challenge address:",P.challengePDA.toString()),P.challengePDA.toString()}catch(A){throw console.error("âŒ Error creating challenge:",A),A}}export{p as createChallenge,y as derivePDAs};
